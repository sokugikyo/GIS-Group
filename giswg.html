<!doctype html>
<html>
 <head>
  <meta charset='utf-8' />
  <title>たんけんMAP</title>
  <link href="https://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-1.8.3.js"></script>
  <script src="https://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
 </head>
 <body>
<!--  <iframe id="frm" width="1104" height="800" src="https://maps.gsi.go.jp/?hc=hifc#10/35.787184/139.809265/&base=std&ls=std&disp=1&vs=c1j1h0k0l0u0t0z0r0s0m0f1" style="position:absolute;top:10px;left:10px;"></iframe> -->
  <iframe id="frm" width="1104" height="800" src="https://maps.gsi.go.jp/?hc=hifc#10/35.787184/139.809265/&base=std&ls=std%7Cseamlessphoto&blend=0&disp=10&vs=c1j0h0k0l0u0t0z0r0s0m0f1&d=v" style="position:absolute;top:10px;left:10px;"></iframe>
  <img width=1800 height=1200 src="tankenMap/p1.png">
  <input type="image" alt="切替" id="d" onclick="komado()" width=1797 height=1200 src="tankenMap/p2.png" style="position:relative;top:-11px;">
  <button id="name" style="position:absolute;top:12px;left:1199px;font-size:32px;background-color:orange;box-shadow:0 1px 3px;display:inline-flex;border-radius:6px;">名称</button>
  <div id="attmenu" style="visibility:hidden;top:18px;left:450px;position:absolute;">
   <div style="background:orange;padding:3px 4px 1px;">
    <select id="pref" onchange="prefchange()" style="font-size:22px;"><option value="" >(市区町村)</option></select>
    <select id="gakk" onchange="gakkochange()" style="font-size:22px;"><option value="">(学校名称)</option></select>
   </div>
  </div>

  <script>
   var ko=1;
   function komado(){
     if(ko!=1){
       ko=1; var el=document.getElementById("d"); 
       el.outerHTML='<input type="image" alt="切替" id="d" onclick="komado()" width=1797 height=1200 src="/tankenMap/p2.png" style="position:relative;top:-11px;">'
     }else{
       ko=2; var el=document.getElementById("d"); 
       el.outerHTML='<input type="image" alt="切替" id="d" onclick="komado()" width=1801 height=1200 src="./tankenMap/p21.png" style="position:relative;top:-11px;left:-3px;">'
     };
   };
   var addrdb=0;
   $.get('../tankenMap/addr.geojson').done(function(data){addrdb=data});
   var gakkodb=0;
   $.get('../tankenMap/gakko.geojson').done(function(data){gakkodb=data});
   document.getElementById("name").addEventListener('click', function(){
     if(document.getElementById('attmenu').style.visibility=="visible"){document.getElementById('attmenu').style.visibility="hidden";}else{
       var pr = document.getElementById("pref");
       while (pr.childNodes.length > 1) {pr.removeChild(pr.lastChild)};
       for(var i=0; i<addrdb.features.length; i++){
         var op = document.createElement('option');
         op.innerText=addrdb.features[i].properties.addr;
         op.value=addrdb.features[i].properties.cd;
         pr.appendChild(op);
       }
       document.getElementById('attmenu').style.visibility="visible";
     }
   });
        
   function prefchange(){
     var sel=[],nn=[];
     for(var i in gakkodb.features){
       if(gakkodb.features[i].properties.P29_001.indexOf($('#pref').val())==0){
         sel.push(gakkodb.features[i].properties); nn.push(i);
       }
     }
     var gk = document.getElementById("gakk");
     while (gk.childNodes.length > 1) {gk.removeChild(gk.lastChild)};
     for(var i=0; i<sel.length; i++){
       var op = document.createElement('option');
       op.innerText=sel[i].P29_005;
       op.value=nn[i];
       gk.appendChild(op);
     }
   }
   function gakkochange(){
     var lat=gakkodb.features[$('#gakk').val()].geometry.coordinates[1];
     var lot=gakkodb.features[$('#gakk').val()].geometry.coordinates[0];
     var frame = document.getElementById("frm");
     frame.src='https://maps.gsi.go.jp/?hc=hifc#17.52/'+lat+'/'+lot+'/&base=std&ls=std%7Cseamlessphoto&blend=0&disp=10&vs=c1j0h0k0l0u0t0z0r0s0m0f1&d=v';
     document.getElementById('attmenu').style.visibility="hidden";
   }
  </script>
 </body>
</html>
